# Main kernel sources

# Generate a heder file for the configuration.
set(MENIX_CONFIG ${MENIX_SRC}/include/generated/config.h CACHE INTERNAL "")
file(WRITE ${MENIX_CONFIG} "#pragma once\n// This file is automatically generated!\n\n")

# Module configuration file.
set(MENIX_MODULES ${MENIX_SRC}/include/generated/exports.h CACHE INTERNAL "")
file(WRITE ${MENIX_MODULES} "#pragma once\n// This file is automatically generated!\n\n")

# Set toolchain.
include(${MENIX_SRC}/toolchain/compiler/${CMAKE_C_COMPILER_ID}.cmake)
include(${MENIX_CONFIG_SRC})
include(${MENIX_SRC}/toolchain/arch/${MENIX_ARCH}.cmake)
include(${MENIX_SRC}/toolchain/arch/defaults.cmake)

add_executable(menix
	main.c
)

set_target_properties(menix PROPERTIES RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin/")

# Global include directories.
include_directories(${MENIX_SRC}/include/)
include_directories(${MENIX_SRC}/include/klibc/)
include_directories(${MENIX_SRC}/kernel/arch/${MENIX_ARCH}/include/)

add_subdirectory(arch/${MENIX_ARCH_DIR})
add_subdirectory(boot)
add_subdirectory(klibc)
add_subdirectory(misc)
add_subdirectory(mod)
add_subdirectory(sys)
add_subdirectory(video)

target_link_libraries(menix PUBLIC
	menix_arch_${MENIX_ARCH_DIR}
	menix_boot
	menix_klibc
	menix_misc
	menix_mod
	menix_sys
	menix_video
)
